<section id="savings-estimator" class="container my-5">

  <!-- Quicksand font -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --accent:#994A80;     /* purple */
      --highlight:#F18815;  /* orange */
      --tile-border:#e5e7eb00;
    }
    body{ font-family:'Quicksand',sans-serif; }

    /* subtle copy spacing */
    #savings-estimator{ letter-spacing:.2px; }
    #savings-estimator .label{ letter-spacing:.3px; }

    /* Layout */
    #savings-estimator .wrap{display:flex;gap:32px;align-items:flex-start}
    #savings-estimator .left {flex:1 1 66%}   /* a bit wider left */
    #savings-estimator .right{flex:0 0 34%}   /* a bit slimmer right */
    #savings-estimator .panel{background:#f3f4f6;border-radius:12px;padding:24px}
    @media (min-width:576px){#savings-estimator .panel{padding:32px}}

    /* Bigger titles on the LEFT column only */
    #savings-estimator .left .panel h4{margin:0 0 12px;font-weight:700;font-size:1.35rem}
    #savings-estimator .muted{color:#667085;font-size:.95rem}

    /* Grid */
    #savings-estimator .apps-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:16px}
    @media (max-width:1200px){#savings-estimator .apps-grid{grid-template-columns:repeat(5,1fr)}}
    @media (max-width:992px){ #savings-estimator .apps-grid{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:768px){ #savings-estimator .apps-grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:520px){ #savings-estimator .apps-grid{grid-template-columns:repeat(2,1fr)}}

    /* Tiles (perfect squares, less rounded, neutral border unless active) */
    #savings-estimator .tile{
      position:relative; background:#fff; border:2px solid var(--tile-border);
      border-radius:6px; padding:10px 8px 8px; text-align:center; cursor:pointer;
      transition:border-color .15s, transform .05s; overflow:visible;
      display:flex; flex-direction:column; justify-content:center;
      aspect-ratio:1/1; /* lock to square */
    }
    #savings-estimator .tile:hover{transform:translateY(-1px)}
    #savings-estimator .tile.active{border-color:var(--accent)}
    #savings-estimator .tile img{
      width:56px;height:56px;object-fit:contain;display:block;margin:2px auto 10px;
      background:transparent;border-radius:4px;box-shadow:none; /* no shadow around logo */
    }
    #savings-estimator .tile .label{
      font-weight:700;font-size:.86rem;color:#344054;white-space:nowrap;overflow:hidden;text-overflow:ellipsis
    }
    /* checkmark slightly outside top-right corner */
    #savings-estimator .tile .badge{
      position:absolute;right:-8px;top:-8px;width:22px;height:22px;border-radius:50%;
      background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:800;transform:scale(0);transition:transform .12s;box-shadow:0 2px 8px rgba(0,0,0,.15)
    }
    #savings-estimator .tile.active .badge{transform:scale(1)}

    /* Users header row (title + purple circular “+”) */
    #savings-estimator .users-head{display:flex;align-items:center;justify-content:space-between;margin-top:18px}
    #savings-estimator .btn-adv{
      width:38px;height:38px;border:none;border-radius:50%;
      background:var(--accent);color:#fff; font-weight:900; font-size:22px; line-height:1;
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
    }

    /* Advanced section (tickets inputs) */
    #savings-estimator .advanced{display:none;margin-top:8px}
    #savings-estimator .advanced.open{display:block}
    #savings-estimator .inline-inputs{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    #savings-estimator .inline-inputs .field{
      display:flex;align-items:center;gap:6px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:8px 10px
    }
    #savings-estimator .inline-inputs input{width:120px;border:none;outline:none;font-weight:600}

    /* Users +/- controls (thicker glyphs) */
    #savings-estimator .controls{display:flex;align-items:center;gap:10px;margin-top:8px}
    #savings-estimator .btn-round{
      background:#fff;color:var(--accent);border:1px solid #e5e7eb;border-radius:12px;
      width:56px;height:48px;font-size:26px;font-weight:900;
      display:inline-flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,.08)
    }
    #savings-estimator .user-input{
      width:120px;height:48px;text-align:center;font-weight:700;
      border:2px solid var(--accent);background:#fff;border-radius:10px;font-size:18px
    }

    /* Right column – ticket/receipt look */
    #savings-estimator .right .ticket{
      background:#fff;border:1px solid #e6e6eb;border-radius:12px;padding:18px 16px;
    }
    /* header line with / month on the far right */
    #savings-estimator .subhead{
      display:flex;align-items:center;justify-content:space-between;
      margin-top:4px;color:#667085;font-size:.95rem;
    }
    /* Thicker dashed separators like a receipt */
    #savings-estimator .sep{
      height:2px;
      background:repeating-linear-gradient(to right,#d7d9df 0 14px,transparent 14px 22px);
      margin:14px 0 18px;
    }

    #savings-estimator .list{list-style:none;padding:0;margin:0}
    #savings-estimator .list li{display:flex;align-items:center;justify-content:space-between;padding:6px 0;font-size:.98rem}
    #savings-estimator .list .rule{color:#475467;font-weight:600;white-space:nowrap;margin-left:12px}

    #savings-estimator .totline{display:flex;align-items:center;justify-content:space-between;font-weight:800;font-size:1.05rem;margin:12px 0 24px}
    #savings-estimator .savings-wrap{text-align:center}
    #savings-estimator .savings-title{font-size:2rem;margin:.6rem 0 .2rem;font-weight:800}

    /* FULL orange highlight (not half underline) */
    #savings-estimator .savings-pill{
      display:inline-block;padding:10px 14px;font-size:2rem;font-weight:900;
      background:var(--highlight);border-radius:10px;color:#1f2937;
    }
    #savings-estimator .small{color:#475467;font-size:.92rem}
  </style>

  <div class="wrap">
    <!-- LEFT -->
    <div class="left">
      <div class="panel">
        <h4>Which apps do you use?</h4>
        <div id="appsGrid" class="apps-grid"></div>

        <div class="users-head">
          <h4 style="margin:0">How many users?</h4>
          <button id="btnAdvanced" class="btn-adv" aria-expanded="false" aria-controls="advancedBox">+</button>
        </div>
        <div class="controls">
          <button class="btn-round" id="btnMinus" aria-label="Remove one">−</button>
          <input id="userCount" class="user-input" type="number" min="1" value="20">
          <button class="btn-round" id="btnPlus"  aria-label="Add one">+</button>
        </div>

        <!-- Advanced (ticket metrics only) -->
        <div id="advancedBox" class="advanced" role="region" aria-labelledby="btnAdvanced">
          <div class="inline-inputs" style="margin-top:8px">
            <div class="field">
              <span>Tickets / month</span>
              <input type="number" id="ticketsPerMonth" value="100" min="0" step="10">
            </div>
            <div class="field">
              <span>Avg ticket €</span>
              <input type="number" id="avgTicketPrice" value="50" min="0" step="1">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right">
      <div class="ticket">
        <h4 class="mb-0">Apps to replace</h4>

        <!-- Subhead with / month right-aligned -->
        <div class="subhead">
          <span>for <b id="usersLabel">20</b> users</span>
          <span>/ month</span>
        </div>

        <div class="sep"></div>

        <ul id="selectedList" class="list"></ul>
        <div class="sep"></div>

        <div class="totline">
          <span>TOTAL</span>
          <div><span id="totalYearly">€0.00</span> <span class="muted">/ year</span></div>
        </div>

        <div class="savings-wrap">
          <div class="savings-title">Your savings</div>
          <div class="savings-pill" id="savingsYearly">€0.00 / year</div>
          <p class="small mt-2">For a fully-integrated software.</p>
        </div>

        <div class="sep" style="margin-top:24px"></div>
        <div class="muted">Est. profit / user / month: <b id="profitPerUser">€0</b></div>
        <div class="muted">Est. total profit / month: <b id="profitTotal">€0</b></div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const CURRENCY = "€";

      /* Revenue model you requested:
         revenue per user r(u) = 20 + 2u
         total monthly revenue = u * r(u)
      */
      function revenuePerUser(u){ return 20 + 2*u; }

      /* Profit curve (kept for info display) */
      const PROFIT_B = 1358, PROFIT_C = 0.07767;
      function profitPerUser(u){ if(u<1) u=1; return 4258 - PROFIT_B * Math.exp(-PROFIT_C*u); }

      // App catalog + rules
      const APPS = [
        { id:'asana',       label:'Project',    icon:'asana.svg',       type:'per_user', rate:20,    ruleText:'$ 20 / user' },
        { id:'quickbooks',  label:'Accounting', icon:'quickbooks.svg',  type:'flat',     base:76,    ruleText:'$ 76' },
        { id:'shopify',     label:'eCommerce',  icon:'shopify.svg',     type:'special',  calc:(ctx)=> 0.01*ctx.revenue + 79, ruleText:'1% Revenue + $ 79' },
        { id:'salesforce',  label:'CRM',        icon:'salesforce.svg',  type:'per_user', rate:165,   ruleText:'$ 165 / user' },
        { id:'slack',       label:'Discuss',    icon:'slack.svg',       type:'per_user', rate:14.10, ruleText:'$ 14.10 / user' },
        { id:'notion',      label:'Knowledge',  icon:'notion.svg',      type:'per_user', rate:14,    ruleText:'$ 14 / user' },
        { id:'bamboohr',    label:'HR',         icon:'bamboohr.svg',    type:'per_user', rate:40,    ruleText:'$ 40 / user' },
        { id:'docusign',    label:'Sign',       icon:'docusign.svg',    type:'per_user', rate:38,    ruleText:'$ 38 / user' },
        { id:'inflow',      label:'Inventory',  icon:'inflow.svg',      type:'flat',     base:349,   ruleText:'$ 349' },
        { id:'wordpress',   label:'Website',    icon:'wordpress.svg',   type:'flat',     base:25,    ruleText:'$ 25' },
        { id:'sharepoint',  label:'Documents',  icon:'sharepoint.svg',  type:'per_user', rate:12.5,  ruleText:'$ 12.5 / user' },
        { id:'lightspeed',  label:'PoS',        icon:'lightspeed.svg',  type:'special',  calc:(ctx)=> 120 + 29 * Math.ceil(ctx.users/5), ruleText:'$ 120 + $ 29 / 5 users' },
        { id:'expensify',   label:'Expenses',   icon:'expensify.svg',   type:'per_user', rate:9,     ruleText:'$ 9 / user' },
        { id:'calendly',    label:'Appointment',icon:'calendly.svg',    type:'per_user', rate:16,    ruleText:'$ 16 / user' },
        { id:'coupa',       label:'Purchase',   icon:'coupa.svg',       type:'flat',     base:2500,  ruleText:'$ 2500' },
        { id:'hootsuite',   label:'Social',     icon:'hootsuite.svg',   type:'flat',     base:249,   ruleText:'$ 249' },
        { id:'clickup',     label:'Planning',   icon:'clickup.svg',     type:'per_user', rate:12,    ruleText:'$ 12 / user' },
        { id:'hubspot',     label:'Emailing',   icon:'hubspot.svg',     type:'per_user', rate:90,    ruleText:'$ 90 / user' },
        { id:'harvest',     label:'Timesheet',  icon:'harvest.svg',     type:'per_user', rate:14,    ruleText:'$ 14 / user' },
        { id:'zendesk',     label:'Helpdesk',   icon:'zendesk.svg',     type:'per_user', rate:115,   ruleText:'$ 115 / user' },
        { id:'eventbrite',  label:'Events',     icon:'eventbrite.svg',  type:'special',  calc:(ctx)=> 0.037*ctx.tickets*ctx.avgTicket + 1.79*ctx.tickets, ruleText:'$ 1.79 + 3.7% / ticket' },
        { id:'katanamrp',   label:'MRP',        icon:'katanamrp.svg',   type:'flat',     base:359,   ruleText:'$ 359' },
        { id:'booqable',    label:'Rental',     icon:'booqable.svg',    type:'special',  calc:(ctx)=> 79 + 20*ctx.users, ruleText:'$ 79 + $ 20 / user' },
      ];

      const DEFAULT_SELECTED = new Set(['asana','quickbooks','salesforce','slack','notion','wordpress']);

      // DOM refs
      const appsGrid   = document.getElementById('appsGrid');
      const selectedEl = document.getElementById('selectedList');
      const usersInput = document.getElementById('userCount');
      const btnMinus   = document.getElementById('btnMinus');
      const btnPlus    = document.getElementById('btnPlus');
      const usersLabel = document.getElementById('usersLabel');
      const ticketsPerMonth = document.getElementById('ticketsPerMonth');
      const avgTicketPrice  = document.getElementById('avgTicketPrice');
      const totalYearlyEl   = document.getElementById('totalYearly');
      const savingsYearlyEl = document.getElementById('savingsYearly');
      const profitPerUserEl = document.getElementById('profitPerUser');
      const profitTotalEl   = document.getElementById('profitTotal');
      const advBtn          = document.getElementById('btnAdvanced');
      const advBox          = document.getElementById('advancedBox');

      // Advanced toggle
      advBtn.addEventListener('click', ()=>{
        const open = advBox.classList.toggle('open');
        advBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
        advBtn.textContent = open ? '–' : '+';
      });

      // State
      const state = {
        users: parseInt(usersInput.value,10) || 20,
        revenue: 0,
        tickets: parseFloat(ticketsPerMonth.value)||100,
        avgTicket: parseFloat(avgTicketPrice.value)||50,
        selected: new Set(DEFAULT_SELECTED),
      };

      // Build tiles
      function renderTiles(){
        appsGrid.innerHTML = '';
        APPS.forEach(app=>{
          const tile = document.createElement('div');
          tile.className = 'tile' + (state.selected.has(app.id) ? ' active' : '');
          tile.dataset.id = app.id;
          tile.innerHTML = `
            <span class="badge">✓</span>
            <img src="icons/${app.icon}" alt="${app.label}">
            <div class="label">${app.label}</div>`;
          tile.addEventListener('click', ()=>{
            if(state.selected.has(app.id)) state.selected.delete(app.id); else state.selected.add(app.id);
            tile.classList.toggle('active');
            recalc();
          });
          appsGrid.appendChild(tile);
        });
      }

      function appMonthlyCost(app, ctx){
        switch(app.type){
          case 'per_user': return app.rate * ctx.users;
          case 'flat':     return app.base;
          case 'special':  return app.calc(ctx);
          default:         return 0;
        }
      }

      function fmtEUR(v){
        return CURRENCY + v.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
      }

      function recalc(){
        // Monthly revenue from your rule
        const perUser = revenuePerUser(state.users);
        state.revenue = perUser * state.users;

        const ctx = {
          users: state.users,
          revenue: state.revenue,
          tickets: state.tickets,
          avgTicket: state.avgTicket
        };

        // Rules list (no per-item totals)
        selectedEl.innerHTML = '';
        let totalMonthly = 0;
        APPS.forEach(app=>{
          if(!state.selected.has(app.id)) return;
          totalMonthly += appMonthlyCost(app, ctx);
          const li = document.createElement('li');
          li.innerHTML = `<span>${app.label}</span><span class="rule">${app.ruleText}</span>`;
          selectedEl.appendChild(li);
        });

        const yearly = totalMonthly * 12;
        totalYearlyEl.textContent   = fmtEUR(yearly);
        savingsYearlyEl.textContent = fmtEUR(yearly) + ' / year';

        usersLabel.textContent = state.users.toString();

        const ppu = profitPerUser(state.users);
        profitPerUserEl.textContent = fmtEUR(ppu);
        profitTotalEl.textContent   = fmtEUR(ppu * state.users);
      }

      // Events
      usersInput.addEventListener('change', ()=>{ state.users = Math.max(1, parseInt(usersInput.value||'1',10)); usersInput.value = state.users; recalc(); });
      btnMinus.addEventListener('click', (e)=>{ e.preventDefault(); if(state.users>1){ state.users--; usersInput.value=state.users; recalc(); }});
      btnPlus.addEventListener('click',  (e)=>{ e.preventDefault(); state.users++; usersInput.value=state.users; recalc(); });

      ticketsPerMonth.addEventListener('input', ()=>{ state.tickets = parseFloat(ticketsPerMonth.value)||0; recalc(); });
      avgTicketPrice .addEventListener('input', ()=>{ state.avgTicket = parseFloat(avgTicketPrice.value)||0; recalc(); });

      // Init
      renderTiles();
      recalc();
    })();
  </script>
</section>
